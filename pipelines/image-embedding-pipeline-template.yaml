# This pipeline cannot be run, which is the template for the image embedding pipeline
# class and defines YAML template file for embedding images, as well as the standard
# inputs and outputs.
name: 'image_embedding_resnet50'
operators:
    -
        name: '_start_op'
        function: '_start_op'
        init_args:
        inputs:
            -
                df: '_start_df'
                name: 'img_path'
                col: 0
        outputs:
            -
                df: 'image'
        iter_info:
            type: map
    -
        name: 'preprocessing'
        function: 'towhee/image-transform-template' #your transform-image repo name
        tag: 'main' #tag to the repo, default is 'main'
        init_args:
            size:      #size of image, such as 256
        inputs:
            -
                df: 'image'
                name: 'img_path'
                col: 0
        outputs:
            -
                df: 'image_preproc'
        iter_info:
            type: map
    -
        name: embedding_model
        function: 'towhee/image-embedding-operator-template' #your image-embedding repo name
        tag: 'main' #tag to the repo, default is 'main'
        init_args:
            model_name:  #model_name for image-embedding operator, such as 'resnet50'
        inputs:
            -
                df: 'image_preproc'
                name: 'img_tensor'
                col: 0
        outputs:
            -
                df: 'embedding'
        iter_info:
            type: map
    -
        name: '_end_op'
        function: '_end_op'
        init_args:
        inputs:
            -
                df: 'embedding'
                name: 'feature_vector'
                col: 0
        outputs:
            -
                df: '_end_df'
        iter_info:
            type: map
dataframes:
    -
        name: '_start_df'
        columns:
            -
                name: 'img_path'
                vtype: 'str'
    -
        name: 'image'
        columns:
            -
                name: 'img_path'
                vtype: 'str'
    -
        name: 'image_preproc'
        columns:
            -
                name: 'img_transformed'
                vtype: 'torch.Tensor'
    -
        name: 'embedding'
        columns:
            -
                name: 'feature_vector'
                vtype: 'numpy.ndarray'
    -
        name: '_end_df'
        columns:
            -
                name: 'feature_vector'
                vtype: 'numpy.ndarray'
